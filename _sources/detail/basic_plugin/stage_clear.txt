.. include:: ../../definition.txt

==============================
StageClear
==============================

|defStageClear| は、 |defUser| がステージを終了したという報告を管理する機能です。

|defStageClear| マスタで、ステージ終了時の状態に応じてプレイヤーに付与する |defBonus| を指定できます。

|defBonus| は、スコアおよびステージをクリアしたか否かの組みあわせによって、複数登録することができます。
付与する |defBonus| は、複数の |defContent| が指定できます。
それぞれの |defContent| について、 |defPresent| 状態か |defInventory| への直接付与かを選ぶこともできます。


不正対策
====================

|defStageClear| では、端末から送信されたクリア状態のデータをもとに動作します。
このため、不正対策機能として、ステージ開始から |defStageClear| までの所要時間と、
スコア上限の2つが利用できます。

ただし、所要時間やスコアから不正と分類できる場合でも、
アイテムの付与やランキングでの集計は正常な登録と同じ動作をします。

----------
時間
----------

所要時間による判定は、以下の手順でおこないます。

ステージ開始時点で、不正とみなす最短所要時間を設定したタイマーを開始してください。
タイマーの状態 |defId| を取得します。

ステージ終了で、 |defStageClear| のAPIのリクエストに、開始時に取得したタイマーの状態 |defId| を設定します。

APIが実行されたときにタイマーが終了していない場合は、不審な登録として記録します。

タイマーの設定は :doc:`timer` を参照してください。

----------
スコア
----------

|defStageClear| マスタには、 |defStageClear| |defId| ごとに上限点数を登録できます。

この点数を上回る登録がきた場合は、不審な登録として記録します。

|defStageClear| の設定例は :doc:`../../master/stage_clear` を参照してください。


提供するAPI
====================

.. csv-table::
    :header: API 名,説明
    :widths: 3,15

    :doc:`../../api/basic_plugin/stage/stage_clear` , |defStageClear| でステージクリア状態を報告します

